# Tracking BARS – БАРС  «МЭИ» в телеграм.

[![Telegram bot](https://img.shields.io/badge/telegram-bot-0088cc.svg)](https://t.me/trackingbarsbot)

Бот позволяет взаимодействовать с [БАРС](https://bars.mpei.ru) в телеграм. Вы можете смотреть оценки в удобной форме и получать уведомления об их изменениях.

## Решения
+ **Микросервисная архитектура** приложения из трех сервисов: telegram (бот), grades (оценки), users (пользователи);
+ Брокер сообщений **RabbitMQ** для общения микросервисов;
+ **Многопоточный парсинг** данных пользователей с использованием **пула горутин**, **каналов** и **веитгруп**.
+ Используются принципы **Clean Architecture** в основе проектирования приложения;
+ Фреймворк [Telebot](https://github.com/tucnak/telebot) для взаимодействия с Telegram API;
+ СУБД **PostgreSQL** для хранения данных (на SQL запросах): [pgx](https://github.com/jackc/pgx);
+ **Docker** и надстройка **docker-compose** для развёртывания;
+ Конфигурация приложения: [cleanenv](https://github.com/ilyakaznacheev/cleanenv) и [godotenv](https://github.com/joho/godotenv);
+ Многоуровневое логирование: [logrus](https://github.com/sirupsen/logrus);
+ AES/CFB шифрование паролей;

## Сборка проекта
1. Клонируйте этот репозиторий: `git clone https://github.com/ilyadubrovsky/tracking-bars`;
2. Создайте `.env` файл для всех сервисов и укажите переменные среды, перечисленные ниже;
3. Откройте корневую директорию проекта в командной строке;
4. Выполните сборку проекта: `make build`;
5. Выполните запуск проекта: `make run`;
6. При первом запуске примените миграции к базе данных: `make migrate-up`.

**Сервис: telegram-service**

| Переменная       | Описание                                                        |
|------------------|-----------------------------------------------------------------|
| `TELEGRAM_TOKEN` | Токен телеграм бота из [@BotFather](https://t.me/BotFather)     |
| `ADMIN_ID`       | ChatID администратора                                           |

**Сервис: grades-service**

| Переменная           | Описание                                                        |
|----------------------|-----------------------------------------------------------------|
| `ENCRYPTION_KEY`     | 32-битный ключ шифрования паролей                               |
| `PG_HOST`            | Хост, по умолчанию указывать `db`                               |
| `PG_PORT`            | Порт, по умолчанию указывать `5432`                             |
| `PG_USERNAME`        | Имя пользователя, по умолчанию указывать `postgres`             |
| `PG_PASSWORD`        | Пароль, по умолчанию указывать `12345678`                       |
| `PG_DATABASE`        | База данных, по умолчанию указывать `trackingbars`              |

**Сервис: user-service**


| Переменная           | Описание                                                        |
|----------------------|-----------------------------------------------------------------|
| `ENCRYPTION_KEY`     | 32-битный ключ шифрования паролей                               |
| `PG_HOST`            | Хост, по умолчанию указывать `db`                               |
| `PG_PORT`            | Порт, по умолчанию указывать `5432`                             |
| `PG_USERNAME`        | Имя пользователя, по умолчанию указывать `postgres`             |
| `PG_PASSWORD`        | Пароль, по умолчанию указывать `12345678`                       |
| `PG_DATABASE`        | База данных, по умолчанию указывать `trackingbars`              |

**Каждый сервис должен содержать:**

| Переменная           | Описание                                                        |
|----------------------|-----------------------------------------------------------------|
| `RABBIT_HOST`        | Хост, по умолчанию указывать `rabbitmq`                         |
| `RABBIT_PORT`        | Порт, по умолчанию указывать `5672`                             |
| `RABBIT_USERNAME`    | Имя пользователя, по умолчанию указывать `guest`                |
| `RABBIT_PASSWORD`    | Пароль, по умолчанию указывать `guest`                          |
